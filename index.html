<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Êó•ÊñáN4Ê∏¨È©ó">

    <!-- Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êó•ÊñáN4ÂñÆÂ≠óËàáÊñáÊ≥ïÊ∏¨È©óÁ≥ªÁµ±</title>
    <style>
    * {
        box-sizing: border-box;
        font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
    }
    body {
        background-color: #f5f5f5;
        margin: 0;
        padding: 20px;
        color: #333;
        line-height: 1.6;
    }
    .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 25px;
        position: relative;
    }
    h1 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #eee;
        padding-bottom: 15px;
    }
    .home-screen, .quiz-screen, .result-screen, .history-screen {
        display: none;
    }
    .home-screen.active, .quiz-screen.active, .result-screen.active, .history-screen.active {
        display: block;
    }
    .home-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 30px;
    }
    .home-btn {
        padding: 15px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 18px;
        transition: background-color 0.3s;
    }
    .home-btn:hover {
        background-color: #2980b9;
    }
    .home-btn.exit {
        background-color: #e74c3c;
    }
    .home-btn.exit:hover {
        background-color: #c0392b;
    }
    .home-btn.update {
        background-color: #2ecc71;
    }
    .home-btn.update:hover {
        background-color: #27ae60;
    }
    
    /* Ê∏¨È©óÈ°ûÂûãÈÅ∏ÊìáÊåâÈàïÊ®£Âºè */
    .count-buttons-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 15px;
    }
    .count-btn {
        margin: 0;
        padding: 15px 10px;
        background-color: #95a5a6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    .count-btn.active {
        background-color: #2ecc71;
        font-weight: bold;
        transform: scale(1.02);
        box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
    }
    .count-btn:hover {
        background-color: #7f8c8d;
        transform: translateY(-2px);
    }
    .count-btn.active:hover {
        background-color: #27ae60;
    }
    
    .question {
        margin-bottom: 25px;
        padding: 15px;
        border-radius: 8px;
        background-color: #f9f9f9;
    }
    .question-number {
        font-weight: bold;
        color: #3498db;
        margin-bottom: 10px;
    }
    .question-text {
        font-size: 18px;
        margin-bottom: 15px;
        line-height: 1.5;
    }
    .kanji {
        font-size: 24px;
        font-weight: bold;
        color: #e74c3c;
        margin: 10px 0;
        text-align: center;
    }
    .options {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .option {
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .option:hover {
        background-color: #f0f0f0;
    }
    .option.selected {
        background-color: #d6eaf8;
        border-color: #3498db;
    }
    .option.correct {
        background-color: #d4edda;
        border-color: #28a745;
    }
    .option.incorrect {
        background-color: #f8d7da;
        border-color: #dc3545;
    }
    .explanation {
        margin-top: 15px;
        padding: 15px;
        background-color: #e8f4fc;
        border-radius: 5px;
        display: none;
    }
    .explanation.show {
        display: block;
    }
    .explanation-title {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 8px;
    }
    .option-explanation {
        margin-top: 10px;
        padding: 8px;
        background-color: #f8f9fa;
        border-radius: 4px;
        font-size: 14px;
    }
    .button-container {
        display: flex;
        justify-content: center;
        margin-top: 30px;
        gap: 15px;
        flex-wrap: wrap;
    }
    button {
        padding: 12px 25px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #2980b9;
    }
    button:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
    }
    button.restart {
        background-color: #e67e22;
    }
    button.restart:hover {
        background-color: #d35400;
    }
    .stats {
        text-align: center;
        margin-bottom: 20px;
        font-size: 18px;
        color: #2c3e50;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .timer {
        font-weight: bold;
        color: #e74c3c;
    }
    .result {
        text-align: center;
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        background-color: #e8f4fc;
    }
    .result-title {
        font-weight: bold;
        font-size: 20px;
        margin-bottom: 10px;
        color: #2c3e50;
    }
    .wrong-questions {
        margin-top: 20px;
        text-align: left;
    }
    .wrong-title {
        font-weight: bold;
        margin-bottom: 10px;
        color: #e74c3c;
    }
    .history-list {
        margin-top: 20px;
    }
    .history-item {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 10px;
        background-color: #f9f9f9;
    }
    .history-date {
        font-weight: bold;
        color: #2c3e50;
    }
    .history-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        flex-wrap: wrap;
    }
    .history-stat {
        flex: 1;
        min-width: 120px;
        text-align: center;
        padding: 5px;
    }
    .question-count-selector {
        margin: 20px 0;
        text-align: center;
    }
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }
    .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        text-align: center;
    }
    .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        text-align: center;
    }
    .update-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 10px;
        height: 10px;
        background-color: #2ecc71;
        border-radius: 50%;
        z-index: 1001;
        animation: pulse 2s infinite;
    }
    .update-indicator.outdated {
        background-color: #e74c3c;
    }
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* ÊâãÊ©üÁâàÊ®£Âºè */
    @media (max-width: 768px) {
        .container {
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .home-btn, button {
            padding: 18px;
            font-size: 16px;
        }
        .question-text {
            font-size: 16px;
        }
        .kanji {
            font-size: 20px;
        }
        .option {
            padding: 15px;
            font-size: 16px;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        .button-container {
            flex-direction: column;
            gap: 10px;
        }
        .button-container button {
            width: 100%;
        }
        .history-stats {
            flex-direction: column;
        }
        .history-stat {
            min-width: 100%;
            text-align: left;
            margin-bottom: 5px;
        }
        .stats {
            flex-direction: column;
            gap: 10px;
        }
        .count-buttons-container {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        .count-btn {
            padding: 18px 15px;
            font-size: 18px;
            min-height: 60px;
        }
        .question-count-selector p {
            font-size: 18px;
            margin-bottom: 15px;
        }
    }
    
    /* Èò≤Ê≠¢ÊâãÊ©ü‰∏äÈªûÊìäÈ´ò‰∫Æ */
    * {
        -webkit-tap-highlight-color: transparent;
    }
    /* ÊîπÂñÑËß∏Êë∏È´îÈ©ó */
    button, .option {
        touch-action: manipulation;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="update-indicator" id="update-indicator"></div>
        <h1>Êó•ÊñáN4ÂñÆÂ≠óËàáÊñáÊ≥ïÊ∏¨È©óÁ≥ªÁµ±</h1>
        
<!-- È¶ñÈ†Å -->
<div id="home-screen" class="home-screen active">
    <div class="home-buttons">
        <button id="start-quiz-btn" class="home-btn">ÈñãÂßãÊ∏¨È©ó</button>
        <button id="update-btn" class="home-btn update">Ê™¢Êü•È°åÂ∫´Êõ¥Êñ∞</button>
        
        <div class="question-count-selector">
            <p>ÈÅ∏ÊìáÊ∏¨È©óÈ°ûÂûãËàáÈ°åÁõÆÊï∏ÈáèÔºö</p>
            <div class="count-buttons-container">
                <button id="count-30-btn" class="count-btn active">30È°å</button>
                <button id="count-50-btn" class="count-btn">50È°å</button>
                <button id="count-past-btn" class="count-btn">Ê≠∑Â±ÜËÄÉÈ°å</button>
                <button id="count-vocab-btn" class="count-btn">ÂñÆÂ≠óÊ∏¨È©ó</button>
            </div>
        </div>
        
        <button id="view-history-btn" class="home-btn">Ê≠∑Âè≤Á¥ÄÈåÑÊü•Ë©¢</button>
        <button id="exit-btn" class="home-btn exit">ÁµêÊùüÊ∏¨È©ó</button>
    </div>
</div> 
        <!-- Ê∏¨È©óÈ†ÅÈù¢ -->
        <div id="quiz-screen" class="quiz-screen">
            <div class="stats">
                <span id="progress">Á¨¨ 1 È°å / ÂÖ± 10 È°å</span>
                <span id="score">ÂæóÂàÜ: 0/0</span>
                <span id="timer" class="timer">ÊôÇÈñì: 00:00</span>
            </div>
            
            <div id="quiz-container">
                <!-- È°åÁõÆÂ∞áÁî±JavaScriptÂãïÊÖãÁîüÊàê -->
            </div>
            
            <div class="button-container">
                <button id="prev-btn" disabled>‰∏ä‰∏ÄÈ°å</button>
                <button id="next-btn">‰∏ã‰∏ÄÈ°å</button>
                <button id="submit-btn" style="display: none;">Êèê‰∫§Á≠îÊ°à</button>
                <button id="back-home-btn" class="restart">ËøîÂõûÈ¶ñÈ†Å</button>
            </div>
        </div>
        
        <!-- ÁµêÊûúÈ†ÅÈù¢ -->
        <div id="result-screen" class="result-screen">
            <div id="result" class="result">
                <!-- Ê∏¨È©óÁµêÊûúÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
            </div>
            
            <div class="button-container">
                <button id="restart-btn" class="restart">ÈáçÊñ∞ÈñãÂßãÊ∏¨È©ó</button>
                <button id="result-back-home-btn">ËøîÂõûÈ¶ñÈ†Å</button>
            </div>
        </div>
        
        <!-- Ê≠∑Âè≤Á¥ÄÈåÑÈ†ÅÈù¢ -->
        <div id="history-screen" class="history-screen">
            <h2>Ê∏¨È©óÊ≠∑Âè≤Á¥ÄÈåÑ</h2>
            
            <div id="history-list" class="history-list">
                <!-- Ê≠∑Âè≤Á¥ÄÈåÑÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
            </div>
            
            <div class="button-container">
                <button id="history-back-home-btn">ËøîÂõûÈ¶ñÈ†Å</button>
                <button id="clear-history-btn" class="restart">Ê∏ÖÈô§Ê≠∑Âè≤Á¥ÄÈåÑ</button>
            </div>
        </div>
    </div>

    <script>
// Ê≠∑Â±ÜËÄÉÈ°åË≥áÊñôÂ∫´
window.pastQuestionBank = [
    {
        id: 101,
        type: "reading",
        question: "Ë´ãÈÅ∏Êìá‰∏ãÂàóÊº¢Â≠óÁöÑÊ≠£Á¢∫ËÆÄÈü≥",
        kanji: "ÂãâÂº∑",
        options: [
            { text: "„Åπ„Çì„Åç„Çá„ÅÜ", explanation: "Ê≠£Á¢∫ÔºÅ„ÄåÂãâÂº∑„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åπ„Çì„Åç„Çá„ÅÜ„Äç" },
            { text: "„Åπ„Çì„Åç„Çá", explanation: "ÈåØË™§ÔºÅÁº∫Â∞ëÈï∑Èü≥" },
            { text: "„Åπ„Çì„Åç„ÇÖ„ÅÜ", explanation: "ÈåØË™§ÔºÅÈÄôÊòØ„ÄåÁ†îÁ©∂„ÄçÁöÑËÆÄÈü≥" },
            { text: "„ÇÅ„Çì„Åç„Çá„ÅÜ", explanation: "ÈåØË™§ÔºÅËÆÄÈü≥‰∏çÊ≠£Á¢∫" }
        ],
        correctAnswer: 0,
        year: "2023",
        season: "Â§èÂ≠£"
    },
    {
        id: 102,
        type: "grammar",
        question: "Ë´ãÈÅ∏ÊìáÊ≠£Á¢∫ÁöÑÊñáÊ≥ïÂΩ¢Âºè",
        sentence: "„Åì„ÅÆÊú¨„ÅØÊò®Êó•ÔºøÔºøÔºøÔºø„ÄÇ",
        options: [
            { text: "Ë≤∑„ÅÑ„Åæ„Åó„Åü", explanation: "Ê≠£Á¢∫ÔºÅË°®Á§∫Êò®Â§©Ë≤∑‰∫ÜÈÄôÊú¨Êõ∏" },
            { text: "Ë≤∑„ÅÑ„Åæ„Åô", explanation: "ÈåØË™§ÔºÅÊáâË©≤‰ΩøÁî®ÈÅéÂéªÂΩ¢" },
            { text: "Ë≤∑„ÅÑ„Åæ„Åó„Çá„ÅÜ", explanation: "ÈåØË™§ÔºÅÈÄôÊòØÂã∏Ë™òÂΩ¢" },
            { text: "Ë≤∑„Å£„Å¶„Åè„Å†„Åï„ÅÑ", explanation: "ÈåØË™§ÔºÅÈÄôÊòØË´ãÊ±ÇÂΩ¢" }
        ],
        correctAnswer: 0,
        year: "2023",
        season: "Êò•Â≠£"
    },
    {
        id: 103,
        type: "vocabulary",
        question: "Ë´ãÈÅ∏ÊìáÊúÄÈÅ©ÂêàÁöÑË©ûË™ûÂ°´ÂÖ•Á©∫Ê†º",
        sentence: "ÈõªËªä„ÅåÔºøÔºøÔºøÔºø„ÅÑ„Åæ„Åô„ÄÇ",
        options: [
            { text: "Ëæº„Çì„Åß", explanation: "Ê≠£Á¢∫ÔºÅË°®Á§∫ÈõªËªäÂæàÊìÅÊì†" },
            { text: "ÂÖ•„Å£„Å¶", explanation: "ÈåØË™§ÔºÅ„ÄåÂÖ•„Å£„Å¶„ÄçÊòØÈÄ≤ÂÖ•ÁöÑÊÑèÊÄù" },
            { text: "Êù•„Å¶", explanation: "ÈåØË™§ÔºÅ„ÄåÊù•„Å¶„ÄçÊòØ‰æÜÁöÑÊÑèÊÄù" },
            { text: "Ë°å„Å£„Å¶", explanation: "ÈåØË™§ÔºÅ„ÄåË°å„Å£„Å¶„ÄçÊòØÂéªÁöÑÊÑèÊÄù" }
        ],
        correctAnswer: 0,
        year: "2022",
        season: "ÂÜ¨Â≠£"
    },
    {
        id: 104,
        type: "writing",
        question: "Ë´ãÈÅ∏Êìá‰∏ãÂàóËÆÄÈü≥ÁöÑÊ≠£Á¢∫Êº¢Â≠ó",
        kana: "„Åó„Åë„Çì",
        options: [
            { text: "Ë©¶È®ì", explanation: "Ê≠£Á¢∫ÔºÅ„Äå„Åó„Åë„Çì„ÄçÁöÑÊº¢Â≠óÊòØ„ÄåË©¶È®ì„Äç" },
            { text: "ÁßÅË¶ã", explanation: "ÈåØË™§ÔºÅ„ÄåÁßÅË¶ã„ÄçÊòØÂÄã‰∫∫ÊÑèË¶ãÁöÑÊÑèÊÄù" },
            { text: "Ë≥áÊ∫ê", explanation: "ÈåØË™§ÔºÅ„ÄåË≥áÊ∫ê„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åó„Åí„Çì„Äç" },
            { text: "‰∫ã‰ª∂", explanation: "ÈåØË™§ÔºÅ„Äå‰∫ã‰ª∂„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åò„Åë„Çì„Äç" }
        ],
        correctAnswer: 0,
        year: "2022",
        season: "ÁßãÂ≠£"
    },
    {
        id: 105,
        type: "synonym",
        question: "Ë´ãÈÅ∏ÊìáËàáÂäÉÁ∑öË©ûË™ûÊÑèÊÄùÊúÄÊé•ËøëÁöÑÈÅ∏È†Ö",
        sentence: "ÂΩº„ÅØ„Å®„Å¶„ÇÇË¶™Âàá„Å™‰∫∫„Åß„Åô„ÄÇ",
        options: [
            { text: "ÂÑ™„Åó„ÅÑ", explanation: "Ê≠£Á¢∫ÔºÅ„ÄåË¶™Âàá„ÄçÂíå„ÄåÂÑ™„Åó„ÅÑ„ÄçÊÑèÊÄùÁõ∏Ëøë" },
            { text: "Âé≥„Åó„ÅÑ", explanation: "ÈåØË™§ÔºÅ„ÄåÂé≥„Åó„ÅÑ„ÄçÊòØÂö¥Ê†ºÁöÑÊÑèÊÄù" },
            { text: "Âº∑„ÅÑ", explanation: "ÈåØË™§ÔºÅ„ÄåÂº∑„ÅÑ„ÄçÊòØÂº∑Â£ØÁöÑÊÑèÊÄù" },
            { text: "Ë≥¢„ÅÑ", explanation: "ÈåØË™§ÔºÅ„ÄåË≥¢„ÅÑ„ÄçÊòØËÅ∞ÊòéÁöÑÊÑèÊÄù" }
        ],
        correctAnswer: 0,
        year: "2021",
        season: "Â§èÂ≠£"
    }
    // ÂèØ‰ª•ÁπºÁ∫åÊ∑ªÂä†Êõ¥Â§öÊ≠∑Â±ÜËÄÉÈ°å...
];

        // ÂÖßÂª∫È°åÂ∫´Ë≥áÊñô
        window.questionBank = [
            {
                id: 1,
                type: "reading",
                question: "Ë´ãÈÅ∏Êìá‰∏ãÂàóÊº¢Â≠óÁöÑÊ≠£Á¢∫ËÆÄÈü≥",
                kanji: "Â≠¶Ê†°",
                options: [
                    { text: "„Åå„Å£„Åì„ÅÜ", explanation: "Ê≠£Á¢∫ÔºÅ„ÄåÂ≠¶Ê†°„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åå„Å£„Åì„ÅÜ„Äç" },
                    { text: "„Åå„Åè„Åì„ÅÜ", explanation: "ÈåØË™§ÔºÅ„ÄåÂ≠¶„ÄçÂú®Ë§áÂêàË©û‰∏≠Â∏∏ËÆÄ‰Ωú„Äå„Åå„Å£„Äç" },
                    { text: "„Åå„Åè„Åç„Çá„ÅÜ", explanation: "ÈåØË™§ÔºÅÈÄôÊòØ„ÄåÂ≠¶Áøí„ÄçÁöÑËÆÄÈü≥" },
                    { text: "„Åå„Å£„Åç„Çá„ÅÜ", explanation: "ÈåØË™§ÔºÅÈÄôÊòØ„ÄåÊ•ΩÂô®„ÄçÁõ∏ÈóúÁöÑËÆÄÈü≥" }
                ],
                correctAnswer: 0
            },
            {
                id: 2,
                type: "writing",
                question: "Ë´ãÈÅ∏Êìá‰∏ãÂàóËÆÄÈü≥ÁöÑÊ≠£Á¢∫Êº¢Â≠ó",
                kana: "„Å®„ÇÇ„Å†„Å°",
                options: [
                    { text: "ÂèãÈÅî", explanation: "Ê≠£Á¢∫ÔºÅ„Äå„Å®„ÇÇ„Å†„Å°„ÄçÁöÑÊº¢Â≠óÊòØ„ÄåÂèãÈÅî„Äç" },
                    { text: "ÂèãÁ´ã", explanation: "ÈåØË™§ÔºÅ„ÄåÁ´ã„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åü„Å°„Äç" },
                    { text: "ÂÖ±ÈÅî", explanation: "ÈåØË™§ÔºÅ„ÄåÂÖ±„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Å®„ÇÇ„Äç‰ΩÜÊÑèÊÄù‰∏çÂêå" },
                    { text: "Áü•Âèã", explanation: "ÈåØË™§ÔºÅÈÄôÊòØËá™ÂâµÁöÑÁµÑÂêà" }
                ],
                correctAnswer: 0
            },
            {
                id: 3,
                type: "vocabulary",
                question: "Ë´ãÈÅ∏ÊìáÊúÄÈÅ©ÂêàÁöÑË©ûË™ûÂ°´ÂÖ•Á©∫Ê†º",
                sentence: "Êò®Êó•„ÄÅÊñ∞„Åó„ÅÑÊú¨„ÇíÔºøÔºøÔºøÔºø„ÄÇ",
                options: [
                    { text: "Ë≤∑„ÅÑ„Åæ„Åó„Åü", explanation: "Ê≠£Á¢∫ÔºÅË°®Á§∫Ë≥ºË≤∑‰∫ÜÊñ∞ÁöÑÊõ∏" },
                    { text: "Â£≤„Çä„Åæ„Åó„Åü", explanation: "ÈåØË™§ÔºÅ„ÄåÂ£≤„Çä„Åæ„Åó„Åü„ÄçÊòØË≥£Âá∫ÁöÑÊÑèÊÄù" },
                    { text: "Ë™≠„Åø„Åæ„Åó„Åü", explanation: "ÈåØË™§ÔºÅÈõñÁÑ∂ÂèØ‰ª•ËÆÄÊõ∏Ôºå‰ΩÜËàá„ÄåÊñ∞„Åó„ÅÑÊú¨„ÄçÁöÑË™ûÂ¢É‰∏çÁ¨¶" },
                    { text: "Êõ∏„Åç„Åæ„Åó„Åü", explanation: "ÈåØË™§ÔºÅ„ÄåÊõ∏„Åç„Åæ„Åó„Åü„ÄçÊòØÂØ´ÁöÑÊÑèÊÄù" }
                ],
                correctAnswer: 0
            },
            {
                id: 4,
                type: "synonym",
                question: "Ë´ãÈÅ∏ÊìáËàáÂäÉÁ∑öË©ûË™ûÊÑèÊÄùÊúÄÊé•ËøëÁöÑÈÅ∏È†Ö",
                sentence: "„Åì„ÅÆÊñôÁêÜ„ÅØ„Å®„Å¶„ÇÇÁæéÂë≥„Åó„ÅÑ„Åß„Åô„ÄÇ",
                options: [
                    { text: "„Åä„ÅÑ„Åó„ÅÑ", explanation: "Ê≠£Á¢∫ÔºÅ„ÄåÁæéÂë≥„Åó„ÅÑ„ÄçÂíå„Äå„Åä„ÅÑ„Åó„ÅÑ„ÄçÊÑèÊÄùÁõ∏Âêå" },
                    { text: "„Åæ„Åö„ÅÑ", explanation: "ÈåØË™§ÔºÅ„Äå„Åæ„Åö„ÅÑ„ÄçÊòØÈõ£ÂêÉÁöÑÊÑèÊÄù" },
                    { text: "„Åç„Çå„ÅÑ", explanation: "ÈåØË™§ÔºÅ„Äå„Åç„Çå„ÅÑ„ÄçÊòØÊºÇ‰∫ÆÁöÑÊÑèÊÄù" },
                    { text: "„ÅÇ„Å§„ÅÑ", explanation: "ÈåØË™§ÔºÅ„Äå„ÅÇ„Å§„ÅÑ„ÄçÊòØÁÜ±ÁöÑÊÑèÊÄù" }
                ],
                correctAnswer: 0
            },
            {
                id: 5,
                type: "grammar",
                question: "Ë´ãÈÅ∏ÊìáÊ≠£Á¢∫ÁöÑÊñáÊ≥ïÂΩ¢Âºè",
                sentence: "ÁßÅ„ÅØÊØéÊó•Êó•Êú¨Ë™ûÔºøÔºøÔºøÔºøÂãâÂº∑„Åó„Åæ„Åô„ÄÇ",
                options: [
                    { text: "„Çí", explanation: "Ê≠£Á¢∫ÔºÅË°®Á§∫Â≠∏ÁøíÁöÑÂ∞çË±°" },
                    { text: "„Åå", explanation: "ÈåØË™§ÔºÅ„Äå„Åå„ÄçÁî®Êñº‰∏ªË™ûÊàñÂ∞çË±°Ë™û" },
                    { text: "„Å´", explanation: "ÈåØË™§ÔºÅ„Äå„Å´„ÄçË°®Á§∫ÊôÇÈñì„ÄÅÂú∞ÈªûÊàñÁõÆÁöÑ" },
                    { text: "„Åß", explanation: "ÈåØË™§ÔºÅ„Äå„Åß„ÄçË°®Á§∫ÊâãÊÆµÊàñÂ†¥ÊâÄ" }
                ],
                correctAnswer: 0
            },
            {
                id: 6,
                type: "reorder",
                question: "Ë´ãÂ∞á‰∏ãÂàóË©ûË™ûÁµÑÂêàÊàêÊ≠£Á¢∫ÁöÑÂè•Â≠ê",
                sentence: "„ÉªÂõ≥Êõ∏È§® „Éª„Åß „ÉªÊú¨ „Éª„Çí „ÉªË™≠„Åø„Åæ„Åô",
                options: [
                    { text: "Âõ≥Êõ∏È§®„ÅßÊú¨„ÇíË™≠„Åø„Åæ„Åô„ÄÇ", explanation: "Ê≠£Á¢∫ÔºÅÈÄôÊòØÊ®ôÊ∫ñÁöÑÊó•Ë™ûË™ûÂ∫è" },
                    { text: "Êú¨„ÇíÂõ≥Êõ∏È§®„ÅßË™≠„Åø„Åæ„Åô„ÄÇ", explanation: "ÈåØË™§ÔºÅÈõñÁÑ∂Ë™ûÊ≥ïÊ≠£Á¢∫Ôºå‰ΩÜ‰∏çÂ¶ÇÈÅ∏È†Ö1Ëá™ÁÑ∂" },
                    { text: "Ë™≠„Åø„Åæ„ÅôÊú¨„ÇíÂõ≥Êõ∏È§®„Åß„ÄÇ", explanation: "ÈåØË™§ÔºÅÂãïË©ûÊáâË©≤Âú®Âè•Â∞æ" },
                    { text: "Âõ≥Êõ∏È§®„ÇíÊú¨„ÅßË™≠„Åø„Åæ„Åô„ÄÇ", explanation: "ÈåØË™§ÔºÅÂä©Ë©û‰ΩøÁî®ÈåØË™§" }
                ],
                correctAnswer: 0
            },
            {
                id: 7,
                type: "reading",
                question: "Ë´ãÈÅ∏Êìá‰∏ãÂàóÊº¢Â≠óÁöÑÊ≠£Á¢∫ËÆÄÈü≥",
                kanji: "ÂÖàÁîü",
                options: [
                    { text: "„Åõ„Çì„Åõ„ÅÑ", explanation: "Ê≠£Á¢∫ÔºÅ„ÄåÂÖàÁîü„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åõ„Çì„Åõ„ÅÑ„Äç" },
                    { text: "„Åõ„Çì„Åõ", explanation: "ÈåØË™§ÔºÅÁº∫Â∞ëÈï∑Èü≥" },
                    { text: "„Åõ„ÅÑ„Åõ„Çì", explanation: "ÈåØË™§ÔºÅÈÄôÊòØ„ÄåÊ∏ÖÊéÉ„ÄçÁõ∏ÈóúÁöÑËÆÄÈü≥" },
                    { text: "„Åõ„Çì„Åõ„Åà", explanation: "ÈåØË™§ÔºÅÈï∑Èü≥ÂΩ¢Âºè‰∏çÊ≠£Á¢∫" }
                ],
                correctAnswer: 0
            },
            {
                id: 8,
                type: "writing",
                question: "Ë´ãÈÅ∏Êìá‰∏ãÂàóËÆÄÈü≥ÁöÑÊ≠£Á¢∫Êº¢Â≠ó",
                kana: "„Å´„Åª„Çì„Åî",
                options: [
                    { text: "Êó•Êú¨Ë™û", explanation: "Ê≠£Á¢∫ÔºÅ„Äå„Å´„Åª„Çì„Åî„ÄçÁöÑÊº¢Â≠óÊòØ„ÄåÊó•Êú¨Ë™û„Äç" },
                    { text: "‰∫åÊú¨Ë™û", explanation: "ÈåØË™§ÔºÅ„Äå‰∫åÊú¨„ÄçÊòØÊï∏ÈáèË©û" },
                    { text: "Êó•Êú¨Âæå", explanation: "ÈåØË™§ÔºÅ„ÄåÂæå„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åî„Äç‰ΩÜÊÑèÊÄù‰∏çÂêå" },
                    { text: "‰∫åÊú¨Âæå", explanation: "ÈåØË™§ÔºÅÈÄôÊòØÈåØË™§ÁöÑÁµÑÂêà" }
                ],
                correctAnswer: 0
            },
            {
                id: 9,
                type: "vocabulary",
                question: "Ë´ãÈÅ∏ÊìáÊúÄÈÅ©ÂêàÁöÑË©ûË™ûÂ°´ÂÖ•Á©∫Ê†º",
                sentence: "ÊòéÊó•„ÅØÂ§©Ê∞ó„ÅåÔºøÔºøÔºøÔºø„Åù„ÅÜ„Åß„Åô„ÄÇ",
                options: [
                    { text: "„Çà„Åï", explanation: "Ê≠£Á¢∫ÔºÅÂΩ¢ÂÆπË©û„Äå„ÅÑ„ÅÑ„ÄçÁöÑÊé®ÈáèÂΩ¢ÊòØ„Äå„Çà„Åï„Äç" },
                    { text: "„ÅÑ„ÅÑ", explanation: "ÈåØË™§ÔºÅ„Äå„ÅÑ„ÅÑ„Äç‰∏çËÉΩÁõ¥Êé•Êé•„Äå„Åù„ÅÜ„Åß„Åô„Äç" },
                    { text: "„Çà„ÅÑ", explanation: "ÈåØË™§ÔºÅÈúÄË¶ÅËÆäÂΩ¢ÁÇ∫„Äå„Çà„Åï„Äç" },
                    { text: "„Çà„Åè", explanation: "ÈåØË™§ÔºÅ„Äå„Çà„Åè„ÄçÊòØÂâØË©ûÂΩ¢Âºè" }
                ],
                correctAnswer: 0
            },
            {
                id: 10,
                type: "grammar",
                question: "Ë´ãÈÅ∏ÊìáÊ≠£Á¢∫ÁöÑÊñáÊ≥ïÂΩ¢Âºè",
                sentence: "„Åì„Åì„Å´ÂêçÂâç„ÇíÔºøÔºøÔºøÔºø„Åè„Å†„Åï„ÅÑ„ÄÇ",
                options: [
                    { text: "Êõ∏„ÅÑ„Å¶", explanation: "Ê≠£Á¢∫ÔºÅ„Å¶ÂΩ¢Áî®ÊñºË´ãÊ±Ç" },
                    { text: "Êõ∏„Åè", explanation: "ÈåØË™§ÔºÅÈúÄË¶Å„Å¶ÂΩ¢" },
                    { text: "Êõ∏„ÅÑ„Åü", explanation: "ÈåØË™§ÔºÅÈÄôÊòØÈÅéÂéªÂΩ¢" },
                    { text: "Êõ∏„Åì„ÅÜ", explanation: "ÈåØË™§ÔºÅÈÄôÊòØÊÑèÂøóÂΩ¢" }
                ],
                correctAnswer: 0
            }
        ];


window.vocabBank = [
    {
        id: "V0001",
        type: "reading",
        question: "Ê¨°„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kanji: "Ëá™ÂàÜ",
        options: [
            {text: "„Åò„Å∂„Çì", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„ÄåËá™„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åò„ÄçÔºå„ÄåÂàÜ„ÄçÈü≥ËÆÄÁÇ∫„Äå„Å∂„Çì„ÄçÔºåÂêàËµ∑‰æÜÊòØ„Äå„Åò„Å∂„Çì„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöËá™Â∑±"},
            {text: "„Åò„Å∑„Çì", explanation: "ÈåØË™§Ôºö„ÄåÂàÜ„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Å∂„Çì„ÄçÔºå‰∏çÊòØ„Äå„Å∑„Çì„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöËá™Â∑±"},
            {text: "„Åò„ÅÑ„Å∂„Çì", explanation: "ÈåØË™§Ôºö„ÄåËá™„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åò„ÄçÔºåÊ≤íÊúâÈï∑Èü≥„ÄÇ„ÄåÂàÜ„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Å∂„Çì„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöËá™Â∑±"},
            {text: "„Åò„Åµ„Çì", explanation: "ÈåØË™§Ôºö„ÄåÂàÜ„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Å∂„Çì„ÄçÔºå‰∏çÊòØ„Äå„Åµ„Çì„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöËá™Â∑±"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0002",
        type: "writing",
        question: "Ê¨°„ÅÆË®ÄËëâ„ÅÆÊ≠£„Åó„ÅÑÊº¢Â≠ó„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kana: "„Åä„Åç„Åæ„Åô",
        options: [
            {text: "Ëµ∑„Åç„Åæ„Åô", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„Äå„Åä„Åç„Åæ„Åô„ÄçÂú®Ê≠§Ë™ûÂ¢É‰∏ãÂ∞çÊáâÁöÑÊº¢Â≠óÊòØ„ÄåËµ∑„Åç„Åæ„Åô„ÄçÔºåÊÑèÊÄùÊòØËµ∑Â∫ä„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöËµ∑Â∫ä"},
            {text: "ÁΩÆ„Åç„Åæ„Åô", explanation: "ÈåØË™§Ôºö„ÄåÁΩÆ„Åç„Åæ„Åô„ÄçÊÑèÊÄùÊòØÊîæÁΩÆÔºåÈõñÁÑ∂ËÆÄÈü≥Áõ∏ÂêåÔºå‰ΩÜË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊîæÁΩÆ"},
            {text: "Êèè„Åç„Åæ„Åô", explanation: "ÈåØË™§Ôºö„ÄåÊèè„Åç„Åæ„Åô„ÄçËÆÄÈü≥ÊòØ„Äå„Åà„Åå„Åç„Åæ„Åô„ÄçÊàñ„Äå„Åã„Åç„Åæ„Åô„ÄçÔºåÊÑèÊÄùÊòØÊèèÁπ™„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊèèÁπ™"},
            {text: "Ê≤ñ„Åç„Åæ„Åô", explanation: "ÈåØË™§Ôºö„ÄåÊ≤ñ„Åç„Åæ„Åô„ÄçËÆÄÈü≥ÊòØ„Äå„Åä„Åç„Åæ„Åô„ÄçÔºå‰ΩÜÊÑèÊÄùÊòØÊ≤ñÊ¥óÔºåË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊ≤ñÊ¥ó"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0003",
        type: "reading",
        question: "Ê¨°„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kanji: "ÂãâÂº∑",
        options: [
            {text: "„Åπ„Çì„Åç„Çá„ÅÜ", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„ÄåÂãâ„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åπ„Çì„ÄçÔºå„ÄåÂº∑„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åç„Çá„ÅÜ„ÄçÔºåÂêàËµ∑‰æÜÊòØ„Äå„Åπ„Çì„Åç„Çá„ÅÜ„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂ≠∏Áøí„ÄÅÁî®Âäü"},
            {text: "„Åπ„Çì„Åç„Çá", explanation: "ÈåØË™§Ôºö„ÄåÂº∑„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åç„Çá„ÅÜ„ÄçÔºå‰∏çÊòØ„Äå„Åç„Çá„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂ≠∏Áøí„ÄÅÁî®Âäü"},
            {text: "„ÇÅ„Çì„Åç„Çá„ÅÜ", explanation: "ÈåØË™§Ôºö„ÄåÂãâ„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åπ„Çì„ÄçÔºå‰∏çÊòØ„Äå„ÇÅ„Çì„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂ≠∏Áøí„ÄÅÁî®Âäü"},
            {text: "„Åπ„Çì„Åç„ÇÖ„ÅÜ", explanation: "ÈåØË™§Ôºö„ÄåÂº∑„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åç„Çá„ÅÜ„ÄçÔºå‰∏çÊòØ„Äå„Åç„ÇÖ„ÅÜ„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂ≠∏Áøí„ÄÅÁî®Âäü"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0004",
        type: "writing",
        question: "Ê¨°„ÅÆË®ÄËëâ„ÅÆÊ≠£„Åó„ÅÑÊº¢Â≠ó„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kana: "„Å®„Åó„Çá„Åã„Çì",
        options: [
            {text: "Âõ≥Êõ∏È§®", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„Äå„Å®„Åó„Çá„Åã„Çì„ÄçÂ∞çÊáâÁöÑÊº¢Â≠óÊòØ„ÄåÂõ≥Êõ∏È§®„ÄçÔºåÊÑèÊÄùÊòØÂúñÊõ∏È§®„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂúñÊõ∏È§®"},
            {text: "Âõ≥Êõ∏ÂÆò", explanation: "ÈåØË™§Ôºö„ÄåÂÆò„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åã„Çì„ÄçÔºå‰ΩÜÊÑèÊÄùÊòØÂÆòÂì°ÔºåË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂúñÊõ∏ÂÆòÂì°"},
            {text: "Âõ≥Êõ∏ÁÆ°", explanation: "ÈåØË™§Ôºö„ÄåÁÆ°„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åã„Çì„ÄçÔºå‰ΩÜÊÑèÊÄùÊòØÁÆ°Â≠êÔºåË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂúñÊõ∏ÁÆ°"},
            {text: "Âõ≥Êõ∏Ëàò", explanation: "ÈåØË™§Ôºö„ÄåËàò„ÄçÊòØ„ÄåÈ§®„ÄçÁöÑÁï∞È´îÂ≠óÔºå‰ΩÜÈÄöÂ∏∏‰ΩøÁî®„ÄåÈ§®„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂúñÊõ∏È§®"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0005",
        type: "reading",
        question: "Ê¨°„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kanji: "ÊóÖË°å",
        options: [
            {text: "„Çä„Çá„Åì„ÅÜ", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„ÄåÊóÖ„ÄçÈü≥ËÆÄÁÇ∫„Äå„Çä„Çá„ÄçÔºå„ÄåË°å„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åì„ÅÜ„ÄçÔºåÂêàËµ∑‰æÜÊòØ„Äå„Çä„Çá„Åì„ÅÜ„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊóÖË°å"},
            {text: "„Çä„Çá„ÅÜ„Åì„ÅÜ", explanation: "ÈåØË™§Ôºö„ÄåÊóÖ„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Çä„Çá„ÄçÔºå‰∏çÊòØ„Äå„Çä„Çá„ÅÜ„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊóÖË°å"},
            {text: "„Çä„Çá„Åì", explanation: "ÈåØË™§Ôºö„ÄåË°å„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åì„ÅÜ„ÄçÔºå‰∏çËÉΩÁúÅÁï•„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊóÖË°å"},
            {text: "„Çä„Åì„ÅÜ", explanation: "ÈåØË™§Ôºö„ÄåÊóÖ„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Çä„Çá„ÄçÔºå‰∏çÊòØ„Äå„Çä„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊóÖË°å"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0006",
        type: "writing",
        question: "Ê¨°„ÅÆË®ÄËëâ„ÅÆÊ≠£„Åó„ÅÑÊº¢Â≠ó„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kana: "„Å≥„Çá„ÅÜ„Åç",
        options: [
            {text: "ÁóÖÊ∞ó", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„Äå„Å≥„Çá„ÅÜ„Åç„ÄçÂ∞çÊáâÁöÑÊº¢Â≠óÊòØ„ÄåÁóÖÊ∞ó„ÄçÔºåÊÑèÊÄùÊòØÁîüÁóÖ„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁîüÁóÖ"},
            {text: "ÁóÖÊ∞£", explanation: "ÈåØË™§Ôºö„ÄåÊ∞£„ÄçÊòØËàäÂ≠óÈ´îÔºåÁèæ‰ª£Êó•Ë™û‰ΩøÁî®„ÄåÊ∞ó„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁîüÁóÖ"},
            {text: "ÁæéÂÆπÊ©ü", explanation: "ÈåØË™§Ôºö„ÄåÁæéÂÆπÊ©ü„ÄçËÆÄÈü≥ÊòØ„Äå„Å≥„Çà„ÅÜ„Åç„ÄçÔºåÊÑèÊÄùÊòØÁæéÂÆπÊ©üÂô®„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁæéÂÆπÊ©üÂô®"},
            {text: "ÊèèÂüü", explanation: "ÈåØË™§ÔºöÊ≠§Êº¢Â≠óÁµÑÂêà‰∏çÂ≠òÂú®‰∏îË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁÑ°ÊÑèÁæ©"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0007",
        type: "reading",
        question: "Ê¨°„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kanji: "È£ü‰∫ã",
        options: [
            {text: "„Åó„Çá„Åè„Åò", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„ÄåÈ£ü„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åó„Çá„Åè„ÄçÔºå„Äå‰∫ã„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åò„ÄçÔºåÂêàËµ∑‰æÜÊòØ„Äå„Åó„Çá„Åè„Åò„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁî®È§ê„ÄÅÂêÉÈ£Ø"},
            {text: "„Åó„Çá„Åè„Åî", explanation: "ÈåØË™§Ôºö„Äå‰∫ã„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åò„ÄçÔºå‰∏çÊòØ„Äå„Åî„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁî®È§ê„ÄÅÂêÉÈ£Ø"},
            {text: "„Åü„Åπ„Åî„Å®", explanation: "ÈåØË™§ÔºöÈÄôÊòØË®ìËÆÄËÆÄÊ≥ïÔºå‰∏çÈÅ©Áî®ÊñºÊ≠§Ë§áÂêàË©û„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁî®È§ê„ÄÅÂêÉÈ£Ø"},
            {text: "„Åó„Çá„Åè„Åò„Å§", explanation: "ÈåØË™§Ôºö„Äå‰∫ã„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åò„ÄçÔºå‰∏çÊòØ„Äå„Åò„Å§„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁî®È§ê„ÄÅÂêÉÈ£Ø"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0008",
        type: "writing",
        question: "Ê¨°„ÅÆË®ÄËëâ„ÅÆÊ≠£„Åó„ÅÑÊº¢Â≠ó„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kana: "„Åß„Çì„Çè",
        options: [
            {text: "ÈõªË©±", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„Äå„Åß„Çì„Çè„ÄçÂ∞çÊáâÁöÑÊº¢Â≠óÊòØ„ÄåÈõªË©±„ÄçÔºåÊÑèÊÄùÊòØÈõªË©±„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÈõªË©±"},
            {text: "ÈõªË©±", explanation: "ÈåØË™§Ôºö„ÄåË©±„ÄçÁöÑÁ∞°È´îÂ≠óÔºåÊó•Ë™û‰∏≠‰ΩøÁî®ÁπÅÈ´îÂ≠ó„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÈõªË©±"},
            {text: "‰ºùË©±", explanation: "ÈåØË™§Ôºö„Äå‰ºù„ÄçËÆÄÈü≥ÊòØ„Äå„Åß„Çì„ÄçÔºå‰ΩÜ„Äå‰ºùË©±„ÄçÊÑèÊÄùÊòØÂÇ≥Ë©±ÔºåË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂÇ≥Ë©±"},
            {text: "ÈõªÂíå", explanation: "ÈåØË™§Ôºö„ÄåÂíå„ÄçËÆÄÈü≥ÊòØ„Äå„Çè„ÄçÔºå‰ΩÜÊÑèÊÄùÊòØÂíåÂπ≥ÔºåË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÈõªÂíå"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0009",
        type: "reading",
        question: "Ê¨°„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kanji: "ÂÆ∂Êóè",
        options: [
            {text: "„Åã„Åû„Åè", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„ÄåÂÆ∂„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åã„ÄçÔºå„ÄåÊóè„ÄçÈü≥ËÆÄÁÇ∫„Äå„Åû„Åè„ÄçÔºåÂêàËµ∑‰æÜÊòØ„Äå„Åã„Åû„Åè„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂÆ∂‰∫∫„ÄÅÂÆ∂Â∫≠"},
            {text: "„Åã„Åû„Åè", explanation: "ÈåØË™§Ôºö„ÄåÂÆ∂„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åã„ÄçÔºå‰∏çÊòØ„Äå„Åë„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂÆ∂‰∫∫„ÄÅÂÆ∂Â∫≠"},
            {text: "„Åã„Åû", explanation: "ÈåØË™§Ôºö„ÄåÊóè„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åû„Åè„ÄçÔºå‰∏çËÉΩÁúÅÁï•„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂÆ∂‰∫∫„ÄÅÂÆ∂Â∫≠"},
            {text: "„Åë„Åû„Åè", explanation: "ÈåØË™§Ôºö„ÄåÂÆ∂„ÄçÁöÑËÆÄÈü≥ÊòØ„Äå„Åã„ÄçÔºå‰∏çÊòØ„Äå„Åë„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂÆ∂‰∫∫„ÄÅÂÆ∂Â∫≠"}
        ],
        correctAnswer: 0
    },
    {
        id: "V0010",
        type: "writing",
        question: "Ê¨°„ÅÆË®ÄËëâ„ÅÆÊ≠£„Åó„ÅÑÊº¢Â≠ó„ÇíÈÅ∏„Å≥„Å™„Åï„ÅÑ",
        kana: "„Å®„ÇÇ„Å†„Å°",
        options: [
            {text: "ÂèãÈÅî", explanation: "Ê≠£Á¢∫Á≠îÊ°àÔºö„Äå„Å®„ÇÇ„Å†„Å°„ÄçÂ∞çÊáâÁöÑÊº¢Â≠óÊòØ„ÄåÂèãÈÅî„ÄçÔºåÊÑèÊÄùÊòØÊúãÂèã„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊúãÂèã"},
            {text: "Âèã„Å†„Å°", explanation: "ÈåØË™§ÔºöÈÄôÊòØÊ∑∑ÂêàÊõ∏ÂØ´ÔºåÊ≠£ÂºèÂ†¥Âêà‰ΩøÁî®„ÄåÂèãÈÅî„Äç„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÊúãÂèã"},
            {text: "ÂÖ±ÈÅî", explanation: "ÈåØË™§Ôºö„ÄåÂÖ±„ÄçËÆÄÈü≥ÊòØ„Äå„Å®„ÇÇ„ÄçÔºå‰ΩÜ„ÄåÂÖ±ÈÅî„ÄçÊÑèÊÄùÊòØÂÖ±ÂêåÈÅîÊàêÔºåË™ûÊÑè‰∏çÁ¨¶„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÂÖ±ÂêåÈÅîÊàê"},
            {text: "Áü•Âèã", explanation: "ÈåØË™§ÔºöÊ≠§Êº¢Â≠óÁµÑÂêà‰∏çËá™ÁÑ∂ÔºåÊó•Ë™û‰∏≠‰∏ç‰ΩøÁî®„ÄÇ\n‰∏≠ÊñáÁøªË≠ØÔºöÁü•ÂøÉÊúãÂèã"}
        ],
        correctAnswer: 0
    },
]


        // ÊáâÁî®ÁãÄÊÖã
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let isAnswered = [];
        let score = 0;
        let wrongQuestions = [];
        let selectedQuestions = [];
        let shuffledQuestions = [];
        let questionCount = 30;
        let isPastQuestions = false; // Êñ∞Â¢ûÔºöÊòØÂê¶ÁÇ∫Ê≠∑Â±ÜËÄÉÈ°åÊ®°Âºè
        let isVocabMode = false; // ÊòØÂê¶ÁÇ∫ÂñÆÂ≠óÊ∏¨È©óÊ®°Âºè
        let timerInterval = null;
        let startTime = null;
        let elapsedTime = 0;
        let history = JSON.parse(localStorage.getItem('n4QuizHistory')) || [];
        let questionBankVersion = localStorage.getItem('questionBankVersion') || '0';
        let lastUpdateCheck = localStorage.getItem('lastUpdateCheck') || 0;

// Áí∞Â¢ÉÊ™¢Ê∏¨ - ‰øÆÊ≠£Âà§Êñ∑ÈÇèËºØ
const isLocal = window.location.protocol === 'file:';
const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
const isGitHub = window.location.hostname.includes('github.io');

// Áí∞Â¢ÉÈÖçÁΩÆ - ‰øÆÊ≠£Âà§Êñ∑
const config = {
    enablePWA: !isLocal,  // Âè™Ë¶Å‰∏çÊòØÊú¨Âú∞Ê™îÊ°àÂ∞±ÂïüÁî®PWA
    enableServiceWorker: !isLocal,
    environment: isLocal ? 'local' : (isDevelopment ? 'development' : 'production')
};


        console.log(`ÈÅãË°åÁí∞Â¢É: ${config.environment}, PWA: ${config.enablePWA ? 'ÂïüÁî®' : 'Á¶ÅÁî®'}`);

        // DOMÂÖÉÁ¥†
        const countVocabBtn = document.getElementById('count-vocab-btn');// DOMÂÖÉÁ¥† - Êñ∞Â¢ûÂñÆÂ≠óÊ∏¨È©óÊåâÈàï
        const homeScreen = document.getElementById('home-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const historyScreen = document.getElementById('history-screen');
        const updateIndicator = document.getElementById('update-indicator');
        
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const viewHistoryBtn = document.getElementById('view-history-btn');
        const exitBtn = document.getElementById('exit-btn');
        const updateBtn = document.getElementById('update-btn');
        const count30Btn = document.getElementById('count-30-btn');
        const count50Btn = document.getElementById('count-50-btn');
        const countPastBtn = document.getElementById('count-past-btn'); // Êñ∞Â¢ûÈÄôË°å
        
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const backHomeBtn = document.getElementById('back-home-btn');
        
        const restartBtn = document.getElementById('restart-btn');
        const resultBackHomeBtn = document.getElementById('result-back-home-btn');
        
        const historyBackHomeBtn = document.getElementById('history-back-home-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        
        const progressElement = document.getElementById('progress');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const resultElement = document.getElementById('result');
        const historyListElement = document.getElementById('history-list');

        // ========== Ê†∏ÂøÉÂäüËÉΩÂáΩÊï∏ (ÂøÖÈ†àÂú® initEventListeners ‰πãÂâçÂÆöÁæ©) ==========

// ‰øÆÊîπÈñãÂßãÊ∏¨È©óÂáΩÊï∏
function startQuiz() {
    // Ê™¢Êü•È°åÂ∫´ÊòØÂê¶Â∑≤Âä†Ëºâ
    if (isVocabMode) {
        // ÂñÆÂ≠óÊ∏¨È©óÊ®°Âºè
        if (!window.vocabBank || window.vocabBank.length === 0) {
            alert('ÂñÆÂ≠óÈ°åÂ∫´Âä†Ëºâ‰∏≠ÔºåË´ãÁ®çÂæåÂÜçË©¶...');
            loadQuestionBank();
            return;
        }
        startVocabQuiz();
    } else if (isPastQuestions) {
        // Ê≠∑Â±ÜËÄÉÈ°åÊ®°Âºè
        if (!window.pastQuestionBank || window.pastQuestionBank.length === 0) {
            alert('Ê≠∑Â±ÜËÄÉÈ°åÂ∫´Âä†Ëºâ‰∏≠ÔºåË´ãÁ®çÂæåÂÜçË©¶...');
            loadQuestionBank();
            return;
        }
        startPastQuiz();
    } else {
        // ‰∏ÄËà¨ÊñáÊ≥ïÊ∏¨È©óÊ®°Âºè
        if (!window.questionBank || window.questionBank.length === 0) {
            alert('È°åÂ∫´Âä†Ëºâ‰∏≠ÔºåË´ãÁ®çÂæåÂÜçË©¶...');
            loadQuestionBank();
            return;
        }
        startGrammarQuiz();
    }
}

// ÂñÆÂ≠óÊ∏¨È©óÈñãÂßãÂáΩÊï∏
function startVocabQuiz() {
    // ÈáçÁΩÆÁãÄÊÖã
    currentQuestionIndex = 0;
    userAnswers = [];
    isAnswered = [];
    score = 0;
    wrongQuestions = [];
    selectedQuestions = [];
    shuffledQuestions = [];
    elapsedTime = 0;

    // Èö®Ê©üÈÅ∏ÊìáÂñÆÂ≠óÈ°åÁõÆ
    const shuffled = shuffleArray([...window.vocabBank]);
    selectedQuestions = shuffled.slice(0, Math.min(questionCount, window.vocabBank.length));
    
    // Èö®Ê©üÊâì‰∫ÇÊØèÂÄãÈ°åÁõÆÁöÑÈÅ∏È†ÖÈ†ÜÂ∫è
    shuffledQuestions = selectedQuestions.map(question => shuffleOptions(question));
    
    userAnswers = new Array(selectedQuestions.length).fill(null);
    isAnswered = new Array(selectedQuestions.length).fill(false);
    
    // ÈñãÂßãË®àÊôÇ
    startTimer();
    
    // È°ØÁ§∫Ê∏¨È©óÈ†ÅÈù¢
    showScreen(quizScreen);
    displayQuestion(currentQuestionIndex);
    updateButtons();
    updateProgress();
}

// ÊñáÊ≥ïÊ∏¨È©óÈñãÂßãÂáΩÊï∏ÔºàÂæûÂéüÊúâÁöÑstartQuizÊãÜÂàÜÂá∫‰æÜÔºâ
function startGrammarQuiz() {
    // ÈáçÁΩÆÁãÄÊÖã
    currentQuestionIndex = 0;
    userAnswers = [];
    isAnswered = [];
    score = 0;
    wrongQuestions = [];
    selectedQuestions = [];
    shuffledQuestions = [];
    elapsedTime = 0;

    // Èö®Ê©üÈÅ∏ÊìáÈ°åÁõÆ
    const shuffled = shuffleArray([...window.questionBank]);
    selectedQuestions = shuffled.slice(0, Math.min(questionCount, window.questionBank.length));
    
    // Èö®Ê©üÊâì‰∫ÇÊØèÂÄãÈ°åÁõÆÁöÑÈÅ∏È†ÖÈ†ÜÂ∫è
    shuffledQuestions = selectedQuestions.map(question => shuffleOptions(question));
    
    userAnswers = new Array(selectedQuestions.length).fill(null);
    isAnswered = new Array(selectedQuestions.length).fill(false);
    
    // ÈñãÂßãË®àÊôÇ
    startTimer();
    
    // È°ØÁ§∫Ê∏¨È©óÈ†ÅÈù¢
    showScreen(quizScreen);
    displayQuestion(currentQuestionIndex);
    updateButtons();
    updateProgress();
}

// Ê≠∑Â±ÜËÄÉÈ°åÈñãÂßãÂáΩÊï∏
function startPastQuiz() {
    // ÈáçÁΩÆÁãÄÊÖã
    currentQuestionIndex = 0;
    userAnswers = [];
    isAnswered = [];
    score = 0;
    wrongQuestions = [];
    selectedQuestions = [];
    shuffledQuestions = [];
    elapsedTime = 0;

    // Èö®Ê©üÈÅ∏ÊìáÈ°åÁõÆ
    const shuffled = shuffleArray([...window.pastQuestionBank]);
    selectedQuestions = shuffled.slice(0, Math.min(questionCount, window.pastQuestionBank.length));
    
    // Èö®Ê©üÊâì‰∫ÇÊØèÂÄãÈ°åÁõÆÁöÑÈÅ∏È†ÖÈ†ÜÂ∫è
    shuffledQuestions = selectedQuestions.map(question => shuffleOptions(question));
    
    userAnswers = new Array(selectedQuestions.length).fill(null);
    isAnswered = new Array(selectedQuestions.length).fill(false);
    
    // ÈñãÂßãË®àÊôÇ
    startTimer();
    
    // È°ØÁ§∫Ê∏¨È©óÈ†ÅÈù¢
    showScreen(quizScreen);
    displayQuestion(currentQuestionIndex);
    updateButtons();
    updateProgress();
}

        // È°ØÁ§∫Ê≠∑Âè≤Á¥ÄÈåÑ
        function showHistory() {
            displayHistory();
            showScreen(historyScreen);
        }

        // ÁµêÊùüÊáâÁî®Á®ãÂºè
        function exitApp() {
            if (confirm('Á¢∫ÂÆöË¶ÅÁµêÊùüÊ∏¨È©óÂóéÔºü')) {
                // Âú®ÁÄèË¶ΩÂô®‰∏≠ÔºåÊàëÂÄëÁÑ°Ê≥ïÁõ¥Êé•ÈóúÈñâË¶ñÁ™óÔºåÈô§ÈùûÊòØPWA
                if (window.navigator.standalone) {
                    window.close();
                } else {
                    showUpdateNotification('Ë´ãÊâãÂãïÈóúÈñâÁÄèË¶ΩÂô®Ê®ôÁ±§È†Å');
                }
            }
        }

        // ËøîÂõûÈ¶ñÈ†Å
        function backToHome() {
            stopTimer();
            showScreen(homeScreen);
        }

        // ‰∏ä‰∏ÄÈ°å
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
                updateButtons();
                updateProgress();
            }
        }

        // ‰∏ã‰∏ÄÈ°å
        function nextQuestion() {
            if (currentQuestionIndex < shuffledQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
                updateButtons();
                updateProgress();
            }
        }

        // Êèê‰∫§Ê∏¨È©ó
        function submitQuiz() {
            stopTimer();
            
            // ÂÑ≤Â≠òÊ≠∑Âè≤Á¥ÄÈåÑ
            const record = {
                date: new Date().toISOString(),
                score: score,
                total: shuffledQuestions.length,
                time: elapsedTime,
                wrongQuestions: [...wrongQuestions]
            };
            
            history.unshift(record);
            // Âè™‰øùÁïôÊúÄËøë10Ê¨°Á¥ÄÈåÑ
            if (history.length > 10) {
                history = history.slice(0, 10);
            }
            
            localStorage.setItem('n4QuizHistory', JSON.stringify(history));
            
            showResults();
            showScreen(resultScreen);
        }

        // ÈáçÊñ∞ÈñãÂßãÊ∏¨È©ó
        function restartQuiz() {
            startQuiz();
        }

// Ë®≠ÂÆöÈ°åÁõÆÊï∏ÈáèÂíåÊ∏¨È©óÈ°ûÂûã
function setQuestionCount(count) {
    if (count === 'past') {
        // Ê≠∑Â±ÜËÄÉÈ°åÊ®°Âºè
        isPastQuestions = true;
        isVocabMode = false;
        const maxAvailable = window.pastQuestionBank ? window.pastQuestionBank.length : 0;
        questionCount = maxAvailable;
        
        // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
        updateCountButtonStates('past');
        
        if (maxAvailable === 0) {
            showUpdateNotification('Ê≠∑Â±ÜËÄÉÈ°åÂ∫´ÁÇ∫Á©∫');
            return;
        }
        
        showUpdateNotification(`Ê≠∑Â±ÜËÄÉÈ°åÊ®°Âºè (${maxAvailable}È°å)`);
    } else if (count === 'vocab') {
        // ÂñÆÂ≠óÊ∏¨È©óÊ®°Âºè
        isPastQuestions = false;
        isVocabMode = true;
        const maxAvailable = window.vocabBank ? window.vocabBank.length : 0;
        questionCount = maxAvailable;
        
        // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
        updateCountButtonStates('vocab');
        
        if (maxAvailable === 0) {
            showUpdateNotification('ÂñÆÂ≠óÈ°åÂ∫´ÁÇ∫Á©∫');
            return;
        }
        
        showUpdateNotification(`ÂñÆÂ≠óÊ∏¨È©óÊ®°Âºè (${maxAvailable}È°å)`);
    } else {
        // ‰∏ÄËà¨È°åÂ∫´Ê®°Âºè
        isPastQuestions = false;
        isVocabMode = false;
        const maxAvailable = window.questionBank ? window.questionBank.length : 0;
        questionCount = Math.min(count, maxAvailable);
        
        // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
        updateCountButtonStates(count);
        
        // Â¶ÇÊûúÈÅ∏ÊìáÁöÑÊï∏ÈáèË∂ÖÈÅéÂèØÁî®È°åÁõÆÔºåÈ°ØÁ§∫ÊèêÁ§∫
        if (count > maxAvailable && maxAvailable > 0) {
            showUpdateNotification(`ÂèØÁî®È°åÁõÆÂè™Êúâ ${maxAvailable} È°å`);
            questionCount = maxAvailable;
        }
    }
}

// Êõ¥Êñ∞Êï∏ÈáèÈÅ∏ÊìáÊåâÈàïÁãÄÊÖã
function updateCountButtonStates(selectedType) {
    // ÁßªÈô§ÊâÄÊúâÊåâÈàïÁöÑactiveÈ°ûÂà•
    count30Btn.classList.remove('active');
    count50Btn.classList.remove('active');
    countPastBtn.classList.remove('active');
    countVocabBtn.classList.remove('active');
    
    // Ê†πÊìöÈÅ∏ÊìáÁöÑÈ°ûÂûãÊ∑ªÂä†activeÈ°ûÂà•
    switch(selectedType) {
        case 30:
            count30Btn.classList.add('active');
            break;
        case 50:
            count50Btn.classList.add('active');
            break;
        case 'past':
            countPastBtn.classList.add('active');
            break;
        case 'vocab':
            countVocabBtn.classList.add('active');
            break;
    }
}

// ‰øÆÊ≠£ÂàùÂßãÂåñ‰∫ã‰ª∂Áõ£ËÅΩÂô®ÂáΩÊï∏
function initEventListeners() {
    // È¶ñÈ†ÅÊåâÈàï
    startQuizBtn.addEventListener('click', startQuiz);
    viewHistoryBtn.addEventListener('click', showHistory);
    exitBtn.addEventListener('click', exitApp);
    updateBtn.addEventListener('click', checkForUpdates);
    
    // Ê∏¨È©óÈ°ûÂûãÈÅ∏ÊìáÊåâÈàï
    count30Btn.addEventListener('click', () => setQuestionCount(30));
    count50Btn.addEventListener('click', () => setQuestionCount(50));
    countPastBtn.addEventListener('click', () => setQuestionCount('past'));
    countVocabBtn.addEventListener('click', () => setQuestionCount('vocab'));
    
    // Ê∏¨È©óÈ†ÅÈù¢ÊåâÈàï - Ê∑ªÂä†ÈÄôÈÉ®ÂàÜ
    prevBtn.addEventListener('click', prevQuestion);
    nextBtn.addEventListener('click', nextQuestion);
    submitBtn.addEventListener('click', submitQuiz);
    backHomeBtn.addEventListener('click', backToHome);
    
    // ÁµêÊûúÈ†ÅÈù¢ÊåâÈàï
    restartBtn.addEventListener('click', restartQuiz);
    resultBackHomeBtn.addEventListener('click', backToHome);
    
    // Ê≠∑Âè≤Á¥ÄÈåÑÈ†ÅÈù¢ÊåâÈàï
    historyBackHomeBtn.addEventListener('click', backToHome);
    clearHistoryBtn.addEventListener('click', clearHistory);
}

// ========== ÂÖ∂‰ªñÂäüËÉΩÂáΩÊï∏ ==========

// ‰øÆÊîπÈ°åÂ∫´ËºâÂÖ•ÂáΩÊï∏‰ª•ÂåÖÂê´ÂñÆÂ≠óÈ°åÂ∫´
async function loadQuestionBank() {
    // Â¶ÇÊûúÊòØÁ∑ö‰∏äÁí∞Â¢ÉÔºåÂòóË©¶ËºâÂÖ•Â§ñÈÉ®È°åÂ∫´
    if (!isLocal) {
        try {
            console.log('Ê≠£Âú®Âæû‰º∫ÊúçÂô®Âä†ËºâÈ°åÂ∫´...');
            // ÂÖàÁ¶ÅÁî®ÈñãÂßãÊ∏¨È©óÊåâÈàï
            startQuizBtn.disabled = true;
            startQuizBtn.textContent = 'È°åÂ∫´ËºâÂÖ•‰∏≠...';
            
            // ÂêåÊôÇËºâÂÖ•ÊâÄÊúâÈ°åÂ∫´
            const [questionBankResponse, pastQuestionBankResponse, vocabBankResponse] = await Promise.all([
                fetch('./question_bank.js'),
                fetch('./pastQuestionBank.js'),
                fetch('./vocab_bank.js') // Êñ∞Â¢ûÔºöËºâÂÖ•ÂñÆÂ≠óÈ°åÂ∫´
            ]);
            
            // ÂãïÊÖãÂü∑Ë°åÈ°åÂ∫´ËÖ≥Êú¨
            if (questionBankResponse.ok) {
                const questionBankScript = await questionBankResponse.text();
                const script1 = document.createElement('script');
                script1.textContent = questionBankScript;
                document.head.appendChild(script1);
            }
            
            if (pastQuestionBankResponse.ok) {
                const pastQuestionBankScript = await pastQuestionBankResponse.text();
                const script2 = document.createElement('script');
                script2.textContent = pastQuestionBankScript;
                document.head.appendChild(script2);
            }
            
            if (vocabBankResponse.ok) {
                const vocabBankScript = await vocabBankResponse.text();
                const script3 = document.createElement('script');
                script3.textContent = vocabBankScript;
                document.head.appendChild(script3);
            }
            
            // Á≠âÂæÖÈ°åÂ∫´ËºâÂÖ•ÂÆåÊàê
            await new Promise(resolve => setTimeout(resolve, 100));
            
            console.log('Â§ñÈÉ®È°åÂ∫´Âä†ËºâÊàêÂäü:');
            console.log('- ‰∏ÄËà¨È°åÂ∫´È°åÁõÆÊï∏Èáè:', window.questionBank ? window.questionBank.length : 0);
            console.log('- Ê≠∑Â±ÜËÄÉÈ°åÈ°åÁõÆÊï∏Èáè:', window.pastQuestionBank ? window.pastQuestionBank.length : 0);
            console.log('- ÂñÆÂ≠óÈ°åÂ∫´È°åÁõÆÊï∏Èáè:', window.vocabBank ? window.vocabBank.length : 0);
            
        } catch (error) {
            console.log('Â§ñÈÉ®È°åÂ∫´Âä†ËºâÂ§±ÊïóÔºå‰ΩøÁî®ÂÖßÂª∫È°åÂ∫´:', error);
            // ‰ΩøÁî®ÂÖßÂª∫È°åÂ∫´‰ΩúÁÇ∫ÂÇôÁî®
            if (!window.questionBank || window.questionBank.length === 0) {
                window.questionBank = window.questionBank || [];
            }
            if (!window.pastQuestionBank || window.pastQuestionBank.length === 0) {
                window.pastQuestionBank = window.pastQuestionBank || [];
            }
            if (!window.vocabBank || window.vocabBank.length === 0) {
                window.vocabBank = window.vocabBank || [];
            }
        }
    }
    
    // ÂïüÁî®ÈñãÂßãÊ∏¨È©óÊåâÈàï
    startQuizBtn.disabled = false;
    startQuizBtn.textContent = 'ÈñãÂßãÊ∏¨È©ó';
    
    // Êõ¥Êñ∞È°åÁõÆÊï∏ÈáèÈÅ∏ÊìáÂô®
    setQuestionCount(questionCount);
}// Ê™¢Êü•È°åÂ∫´ÁâàÊú¨Êõ¥Êñ∞
function checkQuestionBankUpdate() {
    const now = new Date().getTime();
    const oneDay = 24 * 60 * 60 * 1000; // 1Â§©ÁöÑÊØ´ÁßíÊï∏
    
    // Â¶ÇÊûúË∂ÖÈÅé1Â§©Ê≤íÊúâÊ™¢Êü•Êõ¥Êñ∞ÔºåÊàñËÄÖÂº∑Âà∂Êõ¥Êñ∞
    if (now - lastUpdateCheck > oneDay || !localStorage.getItem('cachedQuestionBank')) {
        console.log('Ê™¢Êü•È°åÂ∫´Êõ¥Êñ∞...');
        updateQuestionBankCache();
    } else {
        console.log('‰ΩøÁî®Á∑©Â≠òÁöÑÈ°åÂ∫´ÁâàÊú¨');
    }
    
    localStorage.setItem('lastUpdateCheck', now.toString());
}

// Êõ¥Êñ∞È°åÂ∫´Á∑©Â≠ò
function updateQuestionBankCache() {
    if (window.questionBank && window.questionBank.length > 0) {
        const newVersion = generateQuestionBankVersion(window.questionBank);
        const currentVersion = localStorage.getItem('questionBankVersion');
        
        if (newVersion !== currentVersion) {
            console.log('ÁôºÁèæÊñ∞ÁâàÊú¨È°åÂ∫´ÔºåÊõ¥Êñ∞Á∑©Â≠ò');
            
            // Á∑©Â≠òÈ°åÂ∫´Êï∏Êìö
            localStorage.setItem('cachedQuestionBank', JSON.stringify(window.questionBank));
            localStorage.setItem('questionBankVersion', newVersion);
            
            showUpdateNotification('È°åÂ∫´Â∑≤Êõ¥Êñ∞Âà∞ÊúÄÊñ∞ÁâàÊú¨ÔºÅ');
            updateIndicator.classList.remove('outdated');
        } else {
            console.log('È°åÂ∫´Â∑≤ÊòØÊúÄÊñ∞ÁâàÊú¨');
            updateIndicator.classList.remove('outdated');
        }
    }
}

// ÁîüÊàêÈ°åÂ∫´ÁâàÊú¨Ê®ôË≠ò
function generateQuestionBankVersion(bank) {
    const contentString = JSON.stringify(bank);
    let hash = 0;
    for (let i = 0; i < contentString.length; i++) {
        const char = contentString.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return 'v1.' + Math.abs(hash).toString(16).substring(0, 8);
}

// È°ØÁ§∫Êõ¥Êñ∞ÈÄöÁü•
function showUpdateNotification(message) {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #3498db;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) {
            document.body.removeChild(toast);
        }
    }, 3000);
}

// ÊâãÂãïÊ™¢Êü•Êõ¥Êñ∞ÂáΩÊï∏
function checkForUpdates() {
    console.log('ÊâãÂãïÊ™¢Êü•È°åÂ∫´Êõ¥Êñ∞...');
    showUpdateNotification('Â∑≤Ê™¢Êü•Êõ¥Êñ∞Ôºå‰ΩøÁî®ÂÖßÂª∫È°åÂ∫´');
    updateIndicator.classList.remove('outdated');
}

        // ÈñãÂßãË®àÊôÇ
        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
        }

        // Êõ¥Êñ∞Ë®àÊôÇÂô®
        function updateTimer() {
            const now = new Date();
            elapsedTime = Math.floor((now - startTime) / 1000);
            
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            
            timerElement.textContent = `ÊôÇÈñì: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ÂÅúÊ≠¢Ë®àÊôÇ
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

// È°ØÁ§∫Ê≠∑Âè≤Á¥ÄÈåÑÂÖßÂÆπ
function displayHistory() {
    if (history.length === 0) {
        historyListElement.innerHTML = '<p>Â∞öÁÑ°Ê∏¨È©óÁ¥ÄÈåÑ</p>';
        return;
    }
    
    let historyHTML = '';
    
    history.forEach((record, index) => {
        const date = new Date(record.date).toLocaleString('zh-TW');
        
        // Ë®àÁÆóÂêÑÈ°åÂûãÁöÑÈåØË™§Êï∏Èáè
        const errorTypes = {
            reading: 0,
            writing: 0,
            vocabulary: 0,
            synonym: 0,
            grammar: 0,
            reorder: 0
        };
        
        record.wrongQuestions.forEach(questionId => {
            // ÂÖàÂæû‰∏ÄËà¨È°åÂ∫´ÊâæÔºåÂÜçÂæûÊ≠∑Â±ÜËÄÉÈ°åÂ∫´Êâæ
            let question = window.questionBank.find(q => q.id === questionId);
            if (!question) {
                question = window.pastQuestionBank.find(q => q.id === questionId);
            }
            if (question && errorTypes.hasOwnProperty(question.type)) {
                errorTypes[question.type]++;
            }
        });
        
        historyHTML += `
            <div class="history-item">
                <div class="history-date">Ê∏¨È©ó ${index + 1} - ${date}</div>
                <div class="history-stats">
                    <div class="history-stat">Á≠îÂ∞çÈ°åÊï∏: ${record.score}/${record.total}</div>
                    <div class="history-stat">Áî®ÊôÇ: ${formatTime(record.time)}</div>
                    <div class="history-stat">Êº¢Â≠óËÆÄÈü≥ÈåØË™§: ${errorTypes.reading}</div>
                    <div class="history-stat">Êº¢Â≠óÊõ∏ÂØ´ÈåØË™§: ${errorTypes.writing}</div>
                    <div class="history-stat">Ë©ûË™ûÂ°´Á©∫ÈåØË™§: ${errorTypes.vocabulary}</div>
                    <div class="history-stat">ËøëÁæ©Ë©ûÊõøÊèõÈåØË™§: ${errorTypes.synonym}</div>
                    <div class="history-stat">ÊñáÊ≥ïÈÅ∏ÊìáÈåØË™§: ${errorTypes.grammar}</div>
                    <div class="history-stat">Âè•Â≠êÈáçÁµÑÈåØË™§: ${errorTypes.reorder}</div>
                </div>
            </div>
        `;
    });
    
    historyListElement.innerHTML = historyHTML;
}
        // Ê†ºÂºèÂåñÊôÇÈñìÈ°ØÁ§∫
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Ê∏ÖÈô§Ê≠∑Âè≤Á¥ÄÈåÑ
        function clearHistory() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊ≠∑Âè≤Á¥ÄÈåÑÂóéÔºü')) {
                history = [];
                localStorage.setItem('n4QuizHistory', JSON.stringify(history));
                displayHistory();
            }
        }

        // È°ØÁ§∫ÊåáÂÆöÁï´Èù¢
        function showScreen(screen) {
            homeScreen.classList.remove('active');
            quizScreen.classList.remove('active');
            resultScreen.classList.remove('active');
            historyScreen.classList.remove('active');
            
            screen.classList.add('active');
        }

        // Èö®Ê©üÊâì‰∫ÇÈô£Âàó
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Èö®Ê©üÊâì‰∫ÇÈÅ∏È†ÖÈ†ÜÂ∫è
        function shuffleOptions(question) {
            const optionsWithIndex = question.options.map((option, index) => ({...option, originalIndex: index}));
            const shuffledOptions = shuffleArray(optionsWithIndex);
            
            // Êõ¥Êñ∞Ê≠£Á¢∫Á≠îÊ°àÁöÑÁ¥¢Âºï
            const newCorrectAnswerIndex = shuffledOptions.findIndex(option => option.originalIndex === question.correctAnswer);
            
            return {
                ...question,
                options: shuffledOptions.map(option => ({text: option.text, explanation: option.explanation})),
                correctAnswer: newCorrectAnswerIndex
            };
        }

        // È°ØÁ§∫È°åÁõÆ
        function displayQuestion(index) {
            const question = shuffledQuestions[index];
            let questionHTML = '';
            
            // Ê†πÊìöÈ°åÂûãÁîüÊàê‰∏çÂêåÁöÑHTML
            switch(question.type) {
                case "reading":
                    questionHTML = generateReadingQuestion(question, index);
                    break;
                case "writing":
                    questionHTML = generateWritingQuestion(question, index);
                    break;
                case "vocabulary":
                    questionHTML = generateVocabularyQuestion(question, index);
                    break;
                case "synonym":
                    questionHTML = generateSynonymQuestion(question, index);
                    break;
                case "grammar":
                    questionHTML = generateGrammarQuestion(question, index);
                    break;
                case "reorder":
                    questionHTML = generateReorderQuestion(question, index);
                    break;
                default:
                    questionHTML = generateDefaultQuestion(question, index);
            }
            
            const explanationClass = isAnswered[index] ? 'explanation show' : 'explanation';
            questionHTML += `
                <div class="${explanationClass}">
                    <div class="explanation-title">Ëß£Ë™™Ôºö</div>
                    ${isAnswered[index] ? generateOptionExplanations(question) : question.options[question.correctAnswer].explanation}
                </div>
            `;
            
            quizContainer.innerHTML = questionHTML;
        }

        // ÁîüÊàêÈÅ∏È†ÖËß£Êûê
        function generateOptionExplanations(question) {
            let explanationsHTML = '';
            
            question.options.forEach((option, i) => {
                const isCorrect = i === question.correctAnswer;
                const isSelected = userAnswers[currentQuestionIndex] === i;
                
                explanationsHTML += `
                    <div class="option-explanation" style="${isCorrect ? 'border-left: 4px solid #28a745;' : isSelected ? 'border-left: 4px solid #dc3545;' : ''}">
                        <strong>ÈÅ∏È†Ö ${i+1}: ${option.text}</strong><br>
                        ${option.explanation}
                    </div>
                `;
            });
            
            return explanationsHTML;
        }
// ÁîüÊàêÊº¢Â≠óËÆÄÈü≥È°åÂûã
function generateReadingQuestion(question, index) {
    let optionsHTML = '';
    
    question.options.forEach((option, i) => {
        const isSelected = userAnswers[index] === i;
        const isCorrect = isAnswered[index] && i === question.correctAnswer;
        const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
        
        let optionClass = 'option';
        if (isSelected) optionClass += ' selected';
        if (isCorrect) optionClass += ' correct';
        if (isIncorrect) optionClass += ' incorrect';
        
        optionsHTML += `
            <div class="${optionClass}" onclick="window.selectOption(${i})">
                ${option.text}
            </div>
        `;
    });
    
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
    return `
        <div class="question">
            <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}
            <div class="question-text">${question.question}</div>
            <div class="kanji">${question.kanji}</div>
            <div class="options">
                ${optionsHTML}
            </div>
        </div>
    `;
}


        // ÁîüÊàêÊº¢Â≠óÊõ∏ÂØ´È°åÂûã
        function generateWritingQuestion(question, index) {
            let optionsHTML = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                const isCorrect = isAnswered[index] && i === question.correctAnswer;
                const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
                
                let optionClass = 'option';
                if (isSelected) optionClass += ' selected';
                if (isCorrect) optionClass += ' correct';
                if (isIncorrect) optionClass += ' incorrect';
                
                optionsHTML += `
                    <div class="${optionClass}" onclick="window.selectOption(${i})">
                        ${option.text}
                    </div>
                `;
            });
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
            
            return `
                <div class="question">
                    <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}
                    <div class="question-text">${question.question}</div>
                    <div class="kanji">${question.kana}</div>
                    <div class="options">
                        ${optionsHTML}
                    </div>
                </div>
            `;
        }

        // ÁîüÊàêË©ûË™ûÂ°´Á©∫È°åÂûã
        function generateVocabularyQuestion(question, index) {
            let optionsHTML = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                const isCorrect = isAnswered[index] && i === question.correctAnswer;
                const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
                
                let optionClass = 'option';
                if (isSelected) optionClass += ' selected';
                if (isCorrect) optionClass += ' correct';
                if (isIncorrect) optionClass += ' incorrect';
                
                optionsHTML += `
                    <div class="${optionClass}" onclick="window.selectOption(${i})">
                        ${option.text}
                    </div>
                `;
            });
            
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
            return `
                <div class="question">
                    <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}
                    <div class="question-text">${question.question}</div>
                    <div class="question-text">${question.sentence}</div>
                    <div class="options">
                        ${optionsHTML}
                    </div>
                </div>
            `;
        }

        // ÁîüÊàêËøëÁæ©Ë©ûÊõøÊèõÈ°åÂûã
        function generateSynonymQuestion(question, index) {
            let optionsHTML = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                const isCorrect = isAnswered[index] && i === question.correctAnswer;
                const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
                
                let optionClass = 'option';
                if (isSelected) optionClass += ' selected';
                if (isCorrect) optionClass += ' correct';
                if (isIncorrect) optionClass += ' incorrect';
                
                optionsHTML += `
                    <div class="${optionClass}" onclick="window.selectOption(${i})">
                        ${option.text}
                    </div>
                `;
            });
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
            
            return `
                <div class="question">
                    <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}
                    <div class="question-text">${question.question}</div>
                    <div class="question-text">${question.sentence}</div>
                    <div class="options">
                        ${optionsHTML}
                    </div>
                </div>
            `;
        }

        // ÁîüÊàêÊñáÊ≥ïÈÅ∏ÊìáÈ°åÂûã
        function generateGrammarQuestion(question, index) {
            let optionsHTML = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                const isCorrect = isAnswered[index] && i === question.correctAnswer;
                const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
                
                let optionClass = 'option';
                if (isSelected) optionClass += ' selected';
                if (isCorrect) optionClass += ' correct';
                if (isIncorrect) optionClass += ' incorrect';
                
                optionsHTML += `
                    <div class="${optionClass}" onclick="window.selectOption(${i})">
                        ${option.text}
                    </div>
                `;
            });
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
            
            return `
                <div class="question">
                    <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}
                    <div class="question-text">${question.question}</div>
                    <div class="question-text">${question.sentence}</div>
                    <div class="options">
                        ${optionsHTML}
                    </div>
                </div>
            `;
        }

        // ÁîüÊàêÂè•Â≠êÈáçÁµÑÈ°åÂûã
        function generateReorderQuestion(question, index) {
            let optionsHTML = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                const isCorrect = isAnswered[index] && i === question.correctAnswer;
                const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
                
                let optionClass = 'option';
                if (isSelected) optionClass += ' selected';
                if (isCorrect) optionClass += ' correct';
                if (isIncorrect) optionClass += ' incorrect';
                
                optionsHTML += `
                    <div class="${optionClass}" onclick="window.selectOption(${i})">
                        ${option.text}
                    </div>
                `;
            });
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
            
            return `
                <div class="question">
                    <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}
                    <div class="question-text">${question.question}</div>
                    <div class="question-text">${question.sentence}</div>
                    <div class="options">
                        ${optionsHTML}
                    </div>
                </div>
            `;
        }

// ÁîüÊàêÈ†êË®≠È°åÂûã
function generateDefaultQuestion(question, index) {
    let optionsHTML = '';
    
    question.options.forEach((option, i) => {
        const isSelected = userAnswers[index] === i;
        const isCorrect = isAnswered[index] && i === question.correctAnswer;
        const isIncorrect = isAnswered[index] && isSelected && i !== question.correctAnswer;
        
        let optionClass = 'option';
        if (isSelected) optionClass += ' selected';
        if (isCorrect) optionClass += ' correct';
        if (isIncorrect) optionClass += ' incorrect';
        
        optionsHTML += `
            <div class="${optionClass}" onclick="window.selectOption(${i})">
                ${option.text}
            </div>
        `;
    });
    
    // Â¶ÇÊûúÊòØÊ≠∑Â±ÜËÄÉÈ°åÔºåÈ°ØÁ§∫Âπ¥‰ªΩË≥áË®ä
    const yearInfo = question.year && question.season ? 
        `<div style="font-size: 14px; color: #666; margin-bottom: 10px;">${question.year}Âπ¥ ${question.season}ËÄÉÈ°å</div>` : '';
    
    return `
        <div class="question">
            <div class="question-number">ÂïèÈ°å ${index + 1}</div>
            ${yearInfo}  // Ê∑ªÂä†ÈÄôË°å‰ΩøÁî® yearInfo
            <div class="question-text">${question.question}</div>
            <div class="options">
                ${optionsHTML}
            </div>
        </div>
    `;
}

        // ÈÅ∏ÊìáÈÅ∏È†Ö (Ë®≠ÁÇ∫ÂÖ®ÂüüÂáΩÊï∏)
        window.selectOption = function(optionIndex) {
            if (isAnswered[currentQuestionIndex]) return;
            
            userAnswers[currentQuestionIndex] = optionIndex;
            isAnswered[currentQuestionIndex] = true;
            
            // Ê™¢Êü•Á≠îÊ°à
            const question = shuffledQuestions[currentQuestionIndex];
            if (optionIndex === question.correctAnswer) {
                score++;
            } else {
                // Ë®òÈåÑÈåØË™§È°åÁõÆ
                if (!wrongQuestions.includes(question.id)) {
                    wrongQuestions.push(question.id);
                }
            }
            
            updateScore();
            displayQuestion(currentQuestionIndex);
            updateButtons();
        };

        // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
        function updateButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === shuffledQuestions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                submitBtn.style.display = 'none';
            }
        }

        // Êõ¥Êñ∞ÈÄ≤Â∫¶
        function updateProgress() {
            progressElement.textContent = `Á¨¨ ${currentQuestionIndex + 1} È°å / ÂÖ± ${shuffledQuestions.length} È°å`;
        }

        // Êõ¥Êñ∞ÂàÜÊï∏
        function updateScore() {
            const answeredCount = isAnswered.filter(Boolean).length;
            scoreElement.textContent = `ÂæóÂàÜ: ${score}/${answeredCount}`;
        }

     // È°ØÁ§∫Ê∏¨È©óÁµêÊûú
function showResults() {
    // Ë®àÁÆóÂêÑÈ°åÂûãÁöÑÈåØË™§Êï∏Èáè
    const errorTypes = {
        reading: 0,
        writing: 0,
        vocabulary: 0,
        synonym: 0,
        grammar: 0,
        reorder: 0
    };
    
    wrongQuestions.forEach(questionId => {
        // ÂÖàÂæû‰∏ÄËà¨È°åÂ∫´ÊâæÔºåÂÜçÂæûÊ≠∑Â±ÜËÄÉÈ°åÂ∫´Êâæ
        let question = window.questionBank.find(q => q.id === questionId);
        if (!question) {
            question = window.pastQuestionBank.find(q => q.id === questionId);
        }
        if (question && errorTypes.hasOwnProperty(question.type)) {
            errorTypes[question.type]++;
        }
    });
    
    let resultHTML = `
        <div class="result-title">Ê∏¨È©óÂÆåÊàêÔºÅ</div>
        <div>ÊúÄÁµÇÂæóÂàÜ: ${score}/${shuffledQuestions.length}</div>
        <div>Áî®ÊôÇ: ${formatTime(elapsedTime)}</div>
        <div class="wrong-questions">
            <div class="wrong-title">ÂêÑÈ°åÂûãÈåØË™§ÂàÜÊûêÔºö</div>
            <ul>
                <li>Êº¢Â≠óËÆÄÈü≥ÈåØË™§: ${errorTypes.reading}</li>
                <li>Êº¢Â≠óÊõ∏ÂØ´ÈåØË™§: ${errorTypes.writing}</li>
                <li>Ë©ûË™ûÂ°´Á©∫ÈåØË™§: ${errorTypes.vocabulary}</li>
                <li>ËøëÁæ©Ë©ûÊõøÊèõÈåØË™§: ${errorTypes.synonym}</li>
                <li>ÊñáÊ≥ïÈÅ∏ÊìáÈåØË™§: ${errorTypes.grammar}</li>
                <li>Âè•Â≠êÈáçÁµÑÈåØË™§: ${errorTypes.reorder}</li>
            </ul>
        </div>
    `;
    
    if (wrongQuestions.length > 0) {
        resultHTML += `
            <div class="wrong-questions">
                <div class="wrong-title">ÈåØË™§È°åÁõÆ:</div>
                <ul>
        `;
        
        wrongQuestions.forEach(questionId => {
            // ÂÖàÂæû‰∏ÄËà¨È°åÂ∫´ÊâæÔºåÂÜçÂæûÊ≠∑Â±ÜËÄÉÈ°åÂ∫´Êâæ
            let originalQuestion = window.questionBank.find(q => q.id === questionId);
            if (!originalQuestion) {
                originalQuestion = window.pastQuestionBank.find(q => q.id === questionId);
            }
            
            const shuffledQuestion = shuffledQuestions.find(q => q.id === questionId);
            const userAnswerIndex = userAnswers[shuffledQuestions.indexOf(shuffledQuestion)];
            
            let questionText = '';
            
            if (originalQuestion) {
                if (originalQuestion.type === "reading") {
                    questionText = `${originalQuestion.kanji} - ÊÇ®ÁöÑÁ≠îÊ°à: ${shuffledQuestion.options[userAnswerIndex].text} - Ê≠£Á¢∫Á≠îÊ°à: ${shuffledQuestion.options[shuffledQuestion.correctAnswer].text}`;
                } else if (originalQuestion.type === "writing") {
                    questionText = `${originalQuestion.kana} - ÊÇ®ÁöÑÁ≠îÊ°à: ${shuffledQuestion.options[userAnswerIndex].text} - Ê≠£Á¢∫Á≠îÊ°à: ${shuffledQuestion.options[shuffledQuestion.correctAnswer].text}`;
                } else {
                    questionText = `ÂïèÈ°å ${originalQuestion.id} - ÊÇ®ÁöÑÁ≠îÊ°à: ${shuffledQuestion.options[userAnswerIndex].text} - Ê≠£Á¢∫Á≠îÊ°à: ${shuffledQuestion.options[shuffledQuestion.correctAnswer].text}`;
                }
                
                resultHTML += `<li>${questionText}</li>`;
            }
        });
        
        resultHTML += `
                </ul>
            </div>
        `;
    } else {
        resultHTML += `<div class="success-message">ÊÅ≠ÂñúÔºÅÂÖ®ÈÉ®Á≠îÂ∞çÔºÅ</div>`;
    }
    
    resultElement.innerHTML = resultHTML;
}

        // ÂàùÂßãÂåñÊáâÁî®Á®ãÂºè
        function initApp() {
            initEventListeners();
            
            // Áõ¥Êé•‰ΩøÁî®ÂÖßÂª∫È°åÂ∫´
            loadQuestionBank();
        }

        // ÂïüÂãïÊáâÁî®Á®ãÂºè
        initApp();
    </script>
</body>
</html>